# database
## Концептуальная модель
![conceptual models](https://github.com/user-attachments/assets/b1a53138-ffbc-4ec8-8721-fbbfc5c82ee7)
### Описание таблиц
Кинотеатр (система бронирования билетов) Таблицы: Фильмы Залы Сеансы Билеты Клиенты Сотрудники Отзывы 

Фильмы  – хранит информацию о фильмах (название, жанр, длительность, возрастной рейтинг). 

Залы  – содержит данные о залах (количество мест, тип экрана, звуковая система). 

Сеансы – связывает фильмы с залами и временем показа, указывает стоимость билетов. 

Билеты  – фиксирует купленные билеты (место, дата покупки, статус оплаты). 

Клиенты – содержит данные о зрителях (ФИО, контактная информация, бонусные баллы). 

Сотрудники  – включает информацию о персонале (должность, зарплата, дата приема). 

Отзывы  – хранит оценки и комментарии клиентов о фильмах.
#### Связи между таблицами:
Таблица movies (Фильмы) связана с таблицей sessions (Сеансы) по принципу "один ко многим". Один фильм может иметь несколько сеансов, но каждый сеанс относится только к одному фильму. Это реализуется через внешний ключ movie_id в таблице sessions, ссылающийся на id фильма.
Таблица halls (Залы) также связана с sessions по принципу "один ко многим". Один зал может быть задействован во множестве сеансов, но каждый сеанс проводится только в одном зале. В таблице sessions поле hall_id указывает на конкретный зал из таблицы halls.
Sessions (Сеансы) и tickets (Билеты) также находятся в связи "один ко многим". Один сеанс может включать множество билетов, каждый из которых соответствует отдельному месту. Поле session_id в таблице tickets указывает, к какому сеансу принадлежит билет.
Таблица clients (Клиенты) связана с tickets: один клиент может приобрести несколько билетов, но каждый билет относится к одному клиенту. Связь осуществляется через внешний ключ client_id в таблице tickets.
Аналогично, таблица clients связана с reviews (Отзывы). Один клиент может оставить несколько отзывов, каждый из которых фиксируется в таблице reviews и связан с клиентом через client_id.
Таблица movies также связана с reviews: один фильм может иметь много отзывов, но каждый отзыв относится к одному фильму. Это отражается через внешний ключ movie_id в таблице reviews.
Таблица employees (Сотрудники) в данной структуре является самостоятельной и пока не связана напрямую с другими таблицами. Однако при необходимости можно расширить структуру и добавить, например, связь между сотрудниками и выданными билетами или обслуживаемыми сеансами.
Таким образом, связи между таблицами соответствуют логике работы кинотеатра, позволяют обеспечить целостность данных, избежать дублирования информации и эффективно обрабатывать операции бронирования, отзывов и учёта клиентов.
## Логическая модель
![image](https://github.com/user-attachments/assets/ac0a0b66-99bf-46b5-9aa0-f503ec94d1c2)



### Обоснование выбора нормальной формы
База данных кинотеатра разработана с соблюдением требований третьей нормальной формы (3NF), что обеспечивает логичную, чистую и расширяемую структуру данных.
1NF — Первая нормальная форма:
Все поля в таблицах имеют атомарные значения: например, в таблице билетов каждое поле отвечает только за одно значение — одно место, одна дата покупки, один статус оплаты. В каждой таблице данные строго структурированы и не содержат повторяющихся групп. Каждая запись однозначно идентифицируется с помощью первичного ключа (id).
2NF — Вторая нормальная форма:
Во всех таблицах все неключевые атрибуты полностью зависят от первичного ключа. Например, в таблице sessions цена, время сеанса и зал напрямую зависят от конкретного id-сеанса. Нет частичных зависимостей от части составного ключа, потому что во всех таблицах используется простой первичный ключ (id).
3NF — Третья нормальная форма:
Отсутствуют транзитивные зависимости. Вся информация хранится строго в тематически подходящих таблицах. Например:
Информация о фильмах (жанр, длительность, возрастной рейтинг) не дублируется в сеансах, а хранится отдельно в таблице movies.
Данные клиентов (ФИО, контактная информация) не повторяются в билете, а ссылаются через внешний ключ client_id.
Отзывы не содержат данных о фильмах напрямую — только ссылку на movie_id.
Что даёт соблюдение 3NF:
Минимизация дублирования — одна и та же информация (например, название фильма) хранится только в одной таблице.
Целостность данных — если обновляется информация о клиенте или фильме, это делается в одном месте и сразу отражается во всех связанных данных.
Гибкость и расширяемость — можно легко добавлять новые сущности (например, акции, бронирования или бонусные программы), не затрагивая существующую структуру.
Таким образом, выбор третьей нормальной формы делает базу данных кинотеатра более надёжной, понятной и удобной для долгосрочной работы и развития.
## Обоснование выбора типа версионирования (SCD)
В системе бронирования билетов кинотеатра важно отслеживать изменения определённых данных во времени — таких как информация о клиентах, ценах на сеансы, зарплатах сотрудников или условиях обслуживания. Для этого используется подход управления историей изменений, называемый Slowly Changing Dimensions (SCD) — "медленно изменяющиеся измерения".
В данной системе уместно применять тип SCD 2, поскольку он позволяет сохранять полную историю изменений данных, а не только текущее состояние.
Почему выбран именно SCD Type 2:
1. Необходимость исторического анализа.
Например, важно знать, по какой цене клиент покупал билет на конкретный сеанс, даже если стоимость этого сеанса позже изменилась. Или — какие бонусные баллы были у клиента на момент покупки, даже если баланс позже изменился.
2. Поддержка бизнес-отчетности.
SCD 2 позволяет формировать отчёты с учётом того, какими были данные в определённый момент времени — например, отчет по продажам в декабре с актуальными на тот момент ценами и клиентскими статусами.
3. Минимизация потери данных.
Вместо перезаписи информации, система создаёт новую версию записи с новой датой начала действия (и при необходимости — датой окончания). Таким образом, ни одна информация не теряется.
4. Учет изменений в персонале.
Если у сотрудника изменилась должность или зарплата, важно сохранить как текущие, так и предыдущие значения, чтобы понимать историю занятости и оценивать эффективность.
Пример применения SCD 2:
В таблице sessions или employees можно добавить поля valid_from и valid_to, а также логический флаг is_current. Это позволит:
хранить несколько версий записи;
видеть, какие данные были актуальны на определённую дату;
обеспечить корректные связи с другими таблицами на момент операции (например, продажа билета, начисление бонусов и т.д.).
Таким образом, выбор SCD Type 2 позволяет точно отслеживать изменения, сохранять историю и обеспечивать гибкую аналитику без потери данных, что особенно важно в системе, связанной с продажами, обслуживанием клиентов и кадровым учетом.
## Физическая модель

### Таблица: `movies` (Фильмы)

| Название          | Описание             | Тип данных    | Ограничения                  |
|-------------------|----------------------|---------------|-------------------------------|
| movie_id          | ID фильма            | SERIAL        | PK                            |
| title             | Название             | TEXT          | NOT NULL                      |
| genre             | Жанр                 | TEXT          | NOT NULL                      |
| duration_minutes  | Длительность (мин.)  | INTEGER       | NOT NULL                      |
| age_rating        | Возрастной рейтинг   | TEXT          | CHECK (age_rating IN ('0+', '6+', '12+', '16+', '18+')) |

### Таблица: `halls` (Залы)

| Название          | Описание             | Тип данных    | Ограничения                  |
|-------------------|----------------------|---------------|-------------------------------|
| hall_id           | ID зала              | SERIAL        | PK                            |
| seats_count       | Кол-во мест          | INTEGER       | NOT NULL, CHECK (seats_count > 0) |
| screen_type       | Тип экрана           | TEXT          | NOT NULL                      |
| sound_system      | Звуковая система     | TEXT          | NOT NULL                      |

### Таблица: `sessions` (Сеансы)

| Название          | Описание             | Тип данных    | Ограничения                          |
|-------------------|----------------------|---------------|---------------------------------------|
| session_id        | ID сеанса            | SERIAL        | PK                                    |
| movie_id          | ID фильма            | INTEGER       | FK → movies(movie_id)                |
| hall_id           | ID зала              | INTEGER       | FK → halls(hall_id)                  |
| session_time      | Время показа         | TIMESTAMP     | NOT NULL                              |
| ticket_price      | Стоимость билета     | NUMERIC(8, 2) | NOT NULL                              |

### Таблица: `tickets` (Билеты)

| Название          | Описание             | Тип данных    | Ограничения                          |
|-------------------|----------------------|---------------|---------------------------------------|
| ticket_id         | ID билета            | SERIAL        | PK                                    |
| session_id        | ID сеанса            | INTEGER       | FK → sessions(session_id)            |
| client_id         | ID клиента           | INTEGER       | FK → clients(client_id)              |
| seat_number       | Номер места          | TEXT          | NOT NULL                              |
| purchase_date     | Дата покупки         | TIMESTAMP     | NOT NULL                              |
| payment_status    | Статус оплаты        | TEXT          | CHECK (payment_status IN ('paid', 'unpaid', 'refunded')) |

### Таблица: `clients` (Клиенты)

| Название          | Описание             | Тип данных    | Ограничения                  |
|-------------------|----------------------|---------------|-------------------------------|
| client_id         | ID клиента           | SERIAL        | PK                            |
| full_name         | ФИО                  | TEXT          | NOT NULL                      |
| email             | Email                | TEXT          | UNIQUE, NOT NULL              |
| phone             | Телефон              | TEXT          |                               |
| bonus_points      | Бонусные баллы       | INTEGER       | DEFAULT 0                     |
| registration_date | Дата регистрации     | TIMESTAMP     | NOT NULL                      |

### Таблица: `employees` (Сотрудники)

| Название          | Описание             | Тип данных    | Ограничения                  |
|-------------------|----------------------|---------------|-------------------------------|
| employee_id       | ID сотрудника        | SERIAL        | PK                            |
| full_name         | ФИО                  | TEXT          | NOT NULL                      |
| position          | Должность            | TEXT          | NOT NULL                      |
| salary            | Зарплата             | NUMERIC(10,2) | NOT NULL                      |
| hire_date         | Дата приема на работу| DATE          | NOT NULL                      |

### Таблица: `reviews` (Отзывы)

| Название          | Описание             | Тип данных    | Ограничения                          |
|-------------------|----------------------|---------------|---------------------------------------|
| review_id         | ID отзыва            | SERIAL        | PK                                    |
| client_id         | ID клиента           | INTEGER       | FK → clients(client_id)              |
| movie_id          | ID фильма            | INTEGER       | FK → movies(movie_id)                |
| rating            | Оценка               | NUMERIC(2,1)  | CHECK (rating BETWEEN 1 AND 5)        |
| comment           | Комментарий          | TEXT          |                                       |
| review_date       | Дата отзыва          | TIMESTAMP     | NOT NULL                              |

### Таблица: `session_history` (История изменений сеансов) — SCD Type 2

| Название          | Описание             | Тип данных    | Ограничения                          |
|-------------------|----------------------|---------------|---------------------------------------|
| history_id        | ID записи истории    | SERIAL        | PK                                    |
| session_id        | ID сеанса            | INTEGER       | FK → sessions(session_id)            |
| ticket_price      | Цена билета          | NUMERIC(8,2)  | NOT NULL                              |
| session_time      | Время показа         | TIMESTAMP     | NOT NULL                              |
| valid_from        | Дата начала действия | TIMESTAMP     | NOT NULL                              |
| valid_to          | Дата окончания       | TIMESTAMP     | NULL если актуально                   |

### [ddl.sql](ddl.sql)
```postgresql
-- Таблица: Фильмы
CREATE TABLE movies (
    movie_id SERIAL PRIMARY KEY,
    title TEXT NOT NULL,
    genre TEXT NOT NULL,
    duration_minutes INTEGER NOT NULL,
    age_rating TEXT CHECK (age_rating IN ('0+', '6+', '12+', '16+', '18+'))
);

-- Таблица: Залы
CREATE TABLE halls (
    hall_id SERIAL PRIMARY KEY,
    seats_count INTEGER NOT NULL CHECK (seats_count > 0),
    screen_type TEXT NOT NULL,
    sound_system TEXT NOT NULL
);

-- Таблица: Сеансы
CREATE TABLE sessions (
    session_id SERIAL PRIMARY KEY,
    movie_id INTEGER REFERENCES movies(movie_id),
    hall_id INTEGER REFERENCES halls(hall_id),
    session_time TIMESTAMP NOT NULL,
    ticket_price NUMERIC(8,2) NOT NULL
);

-- Таблица: Клиенты
CREATE TABLE clients (
    client_id SERIAL PRIMARY KEY,
    full_name TEXT NOT NULL,
    email TEXT UNIQUE NOT NULL,
    phone TEXT,
    bonus_points INTEGER DEFAULT 0,
    registration_date TIMESTAMP NOT NULL
);

-- Таблица: Сотрудники
CREATE TABLE employees (
    employee_id SERIAL PRIMARY KEY,
    full_name TEXT NOT NULL,
    position TEXT NOT NULL,
    salary NUMERIC(10,2) NOT NULL,
    hire_date DATE NOT NULL
);

-- Таблица: Билеты
CREATE TABLE tickets (
    ticket_id SERIAL PRIMARY KEY,
    session_id INTEGER REFERENCES sessions(session_id),
    client_id INTEGER REFERENCES clients(client_id),
    seat_number TEXT NOT NULL,
    purchase_date TIMESTAMP NOT NULL,
    payment_status TEXT CHECK (payment_status IN ('paid', 'unpaid', 'refunded'))
);

-- Таблица: Отзывы
CREATE TABLE reviews (
    review_id SERIAL PRIMARY KEY,
    client_id INTEGER REFERENCES clients(client_id),
    movie_id INTEGER REFERENCES movies(movie_id),
    rating NUMERIC(2,1) CHECK (rating BETWEEN 1 AND 5),
    comment TEXT,
    review_date TIMESTAMP NOT NULL
);

-- Таблица: История изменений сеансов (SCD Type 2)
CREATE TABLE session_history (
    history_id SERIAL PRIMARY KEY,
    session_id INTEGER REFERENCES sessions(session_id),
    ticket_price NUMERIC(8,2) NOT NULL,
    session_time TIMESTAMP NOT NULL,
    valid_from TIMESTAMP NOT NULL,
    valid_to TIMESTAMP
);


